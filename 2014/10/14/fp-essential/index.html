<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ( ) -> ( ) · sunnyxx的技术博客</title><meta name="description" content="( ) -&gt; ( ) - sunnyxx"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"></head><body><header><a href="/" class="logo-link"><img src="/doge-logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/1364395395/" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/forkingdog" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">( ) -> ( )</h1><div class="post-time">2014年10月14日</div><div class="post-content"><h1 id="我是前言"><a href="#我是前言" class="headerlink" title="我是前言"></a>我是前言</h1><p><code>() -&gt; ()</code>不是什么表情符号，而是一种高度抽象的编程范式，它表示了一个函数式的编程思想，即<code>值</code>的变化过程。本文将从<code>swift</code>语言入手分析，元组，函数，闭包等的设计对它进行解释，并阐释swift语言设计的大局观。随后分享一个<code>Reactive Cocoa</code>作者的Talk中的编程思想。</p>
<h1 id="编程的核心"><a href="#编程的核心" class="headerlink" title="编程的核心"></a>编程的核心</h1><p>编程的无非两件事，<code>数据</code>和<code>运算</code>。<br>放在计算机硬件，是内存和CPU；<br>放在C语言，是结构体和函数（基本类型本质上就是一个只有一个字段的结构体）；<br>放在面向对象的语言，是类和消息；<br>放在函数式语言，就是值和函数了</p>
<p>如果用<code>()</code>表示数据，<code>-&gt;</code>表示运算，也是醉了</p>
<h1 id="从Swift说起"><a href="#从Swift说起" class="headerlink" title="从Swift说起"></a>从Swift说起</h1><h2 id="gt-表示运算过程"><a href="#gt-表示运算过程" class="headerlink" title="-&gt;表示运算过程"></a>-&gt;表示运算过程</h2><p>熟悉swift的同学肯定能联想到swift中函数的表示方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span><span class="params">(number: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> f = foo <span class="comment">// f的类型为 (Int) -&gt; Int</span></span><br></pre></td></tr></table></figure>
<p>把参数通通去掉之后就成了<code>() -&gt; ()</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">foo</span> <span class="params">()</span></span> -&gt; () &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像好多吐槽swift语法的人一样，起初我也不理解为什么用这么个奇葩的<code>-&gt;</code>来表示返回值，其实它并非表示返回值，而是表示<code>运算过程</code>，从入参到返回值的过程。按这个思路来看，把返回值写在函数声明前面倒是有点说不通了。</p>
<h2 id="元组表示所有的值"><a href="#元组表示所有的值" class="headerlink" title="元组表示所有的值"></a>元组表示所有的值</h2><p>再来说说这个<code>()</code>，在swift里面表示元组（tuple），值得一提的是，swift里面任何值都是一个tuple，且一共有三种Tuple：</p>
<ul>
<li><strong>0-Tuple</strong>表示空值，也就是<code>Void</code> （Void是<code>()</code>的别名）</li>
<li><p><strong>1-Tuple</strong>表示任意一个类型的实例（Int、String、对象、枚举等等），也就是说<code>Int</code>其实是一个<code>(Int)</code>，<code>String</code>是一个<code>(String)</code>，以此类推，所以有下面的写法：</p>
  <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">i.<span class="number">0.0</span>.<span class="number">0.0</span>.<span class="number">0.0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>]</span><br><span class="line">a.<span class="number">0.0</span>.<span class="number">0.0</span>.<span class="number">0.0</span> <span class="comment">// ["A", "B", "C"]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>N-Tuple</strong>表示两个以上值的组合，如<code>(2, &quot;B&quot;)</code></p>
</li>
</ul>
<h2 id="func是一种特殊的block"><a href="#func是一种特殊的block" class="headerlink" title="func是一种特殊的block"></a>func是一种特殊的block</h2><p>一开始我认为block是一种特殊的func，后来发现反过来理解更加合理。  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">bar</span><span class="params">(i: Int)</span></span> &#123;</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f = <span class="type">Foo</span>.bar</span><br></pre></td></tr></table></figure>
<p>其中f的类型为<code>Foo -&gt; (Int) -&gt; ()</code>，用括号结合一下更好理解：<code>Foo -&gt; (Int -&gt; ())</code>，外层传入一个Foo的实例，返回值是一个<code>(Int) -&gt; ()</code>的函数</p>
<p>知道这一点，上面的方法用一个block也能轻松搞定：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bar = &#123;(f: <span class="type">Foo</span>) -&gt; (<span class="type">Int</span>) -&gt; () <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">return</span> &#123;(i: <span class="type">Int</span>) <span class="keyword">in</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以说，一个<code>func</code>只是在一个<code>class</code>（或struct、enum）作用域中一个特殊的block罢了，隐式的被传入了第一层的<code>self</code>参数而已。再多想一步，假如外部有一个全局变量，在<code>func</code>中是可以访问，多么像block的捕获外部变量呢。</p>
<h2 id="swift函数式世界观"><a href="#swift函数式世界观" class="headerlink" title="swift函数式世界观"></a>swift函数式世界观</h2><p>讲到这儿，swift中的<code>数据</code>+<code>运算</code>就可以被抽象成：<code>() -&gt; ()</code>了，一切结构、函数、block，各种调用，本质上都可以被归纳成<strong>从一个元组经过运算得到另一个元组的过程</strong>，这不就是<code>函数式编程</code>么。<br>当然，这个思想也不孤单，<code>java script</code>中也用<code>=&gt;</code>来表示相同的概念</p>
<h1 id="Reactive-Cocoa作者谈未来"><a href="#Reactive-Cocoa作者谈未来" class="headerlink" title="Reactive Cocoa作者谈未来"></a>Reactive Cocoa作者谈未来</h1><p>说完了swift，再来说<code>Reactive Cocoa</code><br>RAC可以说是对objc语言和runtime机制使用最深刻的开源库之一了，可见作者对水平。他的<code>《The Future of Reactive Cocoa》</code>的Talk很有趣，pdf可以从<a href="https://github.com/jspahrsummers/the-future-of-reactivecocoa" target="_blank" rel="external">这个git地址下载</a></p>
<p>他把函数式编程中的Event分成：</p>
<ul>
<li>Observer（Push）: <code>Event -&gt; ()</code></li>
<li>Obserable（Push）: <code>(Event -&gt; ()) -&gt; ()</code></li>
<li>Enumerator（Pull）: <code>() -&gt; Event</code></li>
<li>Enumerable（Pull）: <code>() -&gt; (() -&gt; Event)</code></li>
</ul>
<p>先不说具体含义，这个抽象范式的表示方法就与上面提到一致。熟悉RAC的同学将会对上面精简的概括叫绝。<br>拿第二个，Obserable来说，这就是RAC中的<code>RACSignal</code>，后面的范式表示这个Event可以串联起来（当返回值的也是一个同样结构的函数时）：<br><code>(Event1 -&gt; ()) -&gt; (Event2 -&gt; ()) -&gt;...-&gt; (EventN -&gt; ()) -&gt; ()</code></p>
<h2 id="不寻常意义的Enumerator"><a href="#不寻常意义的Enumerator" class="headerlink" title="不寻常意义的Enumerator"></a>不寻常意义的Enumerator</h2><p>这里的Enumerator不是通常意义上的<code>for-in</code>语句中使用的枚举器，而是代表了一种<code>延时计算</code>的思想：不到最后一刻，这个值一直不被计算出来，向它套用的函数也都将延时到最后才依次计算。其实swift在语言基本库中就实现了它，名为<code>LazyBidirectionalCollection</code>，如一个字典：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dict = [<span class="string">"A"</span>: <span class="number">1</span>, <span class="string">"B"</span>: <span class="number">2</span>]</span><br><span class="line"><span class="keyword">var</span> generator = dict.keys.<span class="built_in">map</span>(&#123;$<span class="number">0</span>.lowercaseString&#125;).generate()</span><br><span class="line">generator.next()! <span class="comment">// "b" （这里进行一次计算）</span></span><br><span class="line">generator.next()! <span class="comment">// "a" （这里进行后一次计算）</span></span><br></pre></td></tr></table></figure>
<h1 id="跑题了，往回拉拉"><a href="#跑题了，往回拉拉" class="headerlink" title="跑题了，往回拉拉"></a>跑题了，往回拉拉</h1><p><code>()</code>表示任意的值<br><code>-&gt;</code>表示运算过程<br>所以<code>() -&gt; ()</code>表示一个任意的函数  </p>
<p>函数作为一等公民，可以作为值进行传递，所以上面的范式中的值也可以是函数，于是衍生出<br><code>(() -&gt; ()) -&gt; ()</code>或<code>() -&gt; (() -&gt; ())</code></p>
<p>这就是函数式编程</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://medium.com/swift-programming/facets-of-swift-part-2-tuples-4bfe58d21abf" target="_blank" rel="external">https://medium.com/swift-programming/facets-of-swift-part-2-tuples-4bfe58d21abf</a><br><a href="https://github.com/jspahrsummers/the-future-of-reactivecocoa" target="_blank" rel="external">https://github.com/jspahrsummers/the-future-of-reactivecocoa</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2014/10/15/behind-autorelease/" class="prev">上一篇</a><a href="/2014/09/15/objc-attribute-cleanup/" class="next">下一篇</a></div><div data-thread-key="2014/10/14/fp-essential/" data-title="( ) -&gt; ( )" data-url="http://blog.sunnyxx.com/2014/10/14/fp-essential/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"sunnyxx"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>原创文章，版权声明：署名-非商业性使用-相同方式共享 2.5 </p><p>对博主感兴趣？微信订阅号中关注 sunnyxx 或关注微博<a href="http://weibo.com/1364395395/">@我就叫Sunny怎么了</a></p><p>© 2015 - 2016  <a href="http://blog.sunnyxx.com">sunnyxx</a> | Powered by Hexo</p></div></footer></body></html>